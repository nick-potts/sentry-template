FROM confluentinc/cp-kafka:7.6.6

ENV KAFKA_PROCESS_ROLES=broker,controller
ENV KAFKA_CONTROLLER_QUORUM_VOTERS=1001@127.0.0.1:29093
ENV KAFKA_CONTROLLER_LISTENER_NAMES=CONTROLLER
ENV KAFKA_NODE_ID=1001
ENV CLUSTER_ID=MkU3OEVBNTcwNTJENDM2Qk
ENV KAFKA_LISTENERS=PLAINTEXT://[::]:29092,INTERNAL://[::]:9093,EXTERNAL://[::]:9092,CONTROLLER://[::]:29093
ENV KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:29092,INTERNAL://[::]:9093,EXTERNAL://[::]:9092
ENV KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT,CONTROLLER:PLAINTEXT
ENV KAFKA_INTER_BROKER_LISTENER_NAME=PLAINTEXT
ENV KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
ENV KAFKA_OFFSETS_TOPIC_NUM_PARTITIONS=1
ENV KAFKA_LOG_RETENTION_HOURS=24
ENV KAFKA_MESSAGE_MAX_BYTES=50000000
ENV KAFKA_MAX_REQUEST_SIZE=50000000
ENV CONFLUENT_SUPPORT_METRICS_ENABLE=false
ENV KAFKA_LOG4J_LOGGERS=kafka.cluster=WARN,kafka.controller=WARN,kafka.coordinator=WARN,kafka.log=WARN,kafka.server=WARN,state.change.logger=WARN
ENV KAFKA_LOG4J_ROOT_LOGLEVEL=WARN
ENV KAFKA_TOOLS_LOG4J_LOGLEVEL=WARN

EXPOSE 9092 9093 29092 29093

HEALTHCHECK --interval=10s --timeout=10s --retries=30 \
  CMD nc -z localhost 9092 || exit 1
